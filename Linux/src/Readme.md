# D01_Linux Carnaget

* Установка и обновления системы Linux. Основы администрирования.

<br>

## Part 1. Установка ОС

**== Задание ==**

- Установить **Ubuntu 20.04 Server LTS** без графического интерфейса.

<br>

**== Выполнение ==**

* Проводим устоновку образа **Ubuntu 20.04 srver LST** 
* Ставим образ на **VirtualBox**
* Результат выполненого запроса `cat /etc/issue` внутри получившейся виртуальной машины
![Верися ubuntu](task%201/task%201.png)<br>*Версия Ubuntu*<br>


<br>

## Part 2. Создание пользователя

**== Задание ==**

- Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу `adm`.

<br>

**== Выполнение ==**

* Выполняем команды `sudo adduser carnagetv2` и `sudo usermod -aG adm carnagetv2` для создания нового юзера и добавление его в группу `adm`

![Результат выполнения команд](task%202/task%202.1.png)<br>*Результат выполнения команд*<br>

* Для проверки успеха выполнения задания выполняем `vim /etc/group`, что позволит посмотреть появился ли новый пользователь в группе `adm`

![Содержимое файла group](task%202/task%202.2.png)<br>*Содержимое файла group*<br>


<br>

## Part 3. Настройка сети OC

**== Задание ==**

- 1) Задать название машины вида user-1

- 2) Установить временную зону, соответствующую вашему текущему местоположению.

- 3) Вывести названия сетевых интерфейсов с помощью консольной команды. (Объяснить что такое lo)

- 4) Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера. (Объяснить что такое dhcp)

- 5) Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).

- 6) Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

- 7) Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.

<br>

**== Выполнение ==**

<br>

### Exercise 1:

* Последовательно выполняем команды `sudo chmod 746 /etc/hostname` и  `sudo echo user-1 > /etc/hostname`

* Выполняя `cat /etc/hostname` проверяем результат

![Результат смены имени машины](task%203/task%203.1.png)<br>*Результат смены имени машины*<br>

<br>

### Exercise 2:

* Выполняем команду `sudo timedatectl set-timezone Europe/Moscow`

* Проверяем результат выполнив `timedatectl`

![Результат перевода системного времени](task%203/task%203.2.png)<br>*Результат перевода системного времени*<br>

<br>

### Exercise 3:

* Выполняем команду `ls /sys/class/net` для отображения сетевых интерфейсов

![Результат выполнения команды](task%203/task%203.3.png)<br>*Результат выполнения команды*<br>

* **lo это** - программный петлевой сетевой интерфейс. Это программный механизм замыкания на себя который можно использовать для повышения производительности, проведения анализа и тестирований программного обеспечения, и локальных коммуникаций.

<br>

### Exercise 4: 

* Выполняем команду `ip r`

![Результат выполнения команды](task%203/task%203.4.png)<br>*Результат выполнения команды*<br>

* **DHCP это** - протокол динамической настройки узла, прикладной протокол, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP.

<br>

### Exercise 5:

* Последовательно выполняем команды для вывода внешнего ip шлюза, а потом внутренего `wget -qO- eth0.me` и `ip route | grep default`

![Внешний и внутренний IP-адрес шлюза](task%203/task%203.5.png)<br>*Внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза*<br>

<br>

### Exercise 6:

* Меняем доступ к файлу для дальнейшего его редактирования `sudo chmod 777 /etc/netplan/00-installer-config.yaml`

* Редактируем фаил под нужные настроики используя `vim /etc/netplan/00-installer-config.yaml` 

![Итоговые параметры в файле](task%203/task%203.6.png)<br>*Итоговые параметры в файле*<br>

* Сохраняем изменения командой `sudo netplan apply` и перехапускаем машину

<br>

### Exercise 7:

* После перезапуска пингуем командой `hostname -I && ping -c 4 1.1.1.1 | grep "stat\|loss" && ping -c 4 ya.ru`

![Вывод команды](task%203/task%203.7.png)<br>*Вывод команды*<br>


<br>

## Part 4. Обновление ОС

**== Задание ==**

* Обновить системные пакеты до последней на момент выполнения задания версии.  

- После обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют.
- Вставить скриншот с этим сообщением в отчёт.

<br>

**== Выполнение ==**

* Выполняем команду `sudo apt update` для получения доступных пакетов

 ![Доступные к установке пакеты](task%204/task%204.1.png)<br>*Доступные к установке пакеты*<br>

 * Обновляем системные пакеты до последней версии командой `sudo apt full-upgrade`

 * Запускаем команду обнавления ещё раз (Проверяем получилось ли провести обновление)

 ![Результат повторного обновления](task%204/task%204.2.png)<br>*Результат повторного обновления*<br>


<br>

## Part 5. Использование команды **sudo**

**== Задание ==**

* Разрешить пользователю, созданному в Part 2, выполнять команду sudo.

- В отчёте объяснить *истинное* назначение команды sudo (про то, что это слово - "волшебное", писать не стоит).  
- Поменять hostname ОС от имени пользователя, созданного в пункте Part 2.
- Вставить скрин с изменённым hostname в отчёт.

<br>

 **== Выполнение ==**

 sudo это - команда которая позволяет строго определенным пользователям выполнять указанные программы с 
 административными привилегиями без ввода пароля суперпользователя root. Если быть точнее, то 
 команда sudo позволяет выполнять программы от имени любого пользователя, но, если идентификатор 
 или имя этого пользователя не указаны, то предполагается выполнение от имени суперпользователя root.

* Командой `sudo usermod -a -G sudo carnagetv2` разрешаем пользователю использовать sudo

* Командой `su - carnagetv2` меняем пользователя

* Изменение hostname под другим пользователем `sudo echo user-2 > /etc/hostname` 

* `cat /etc/hostname` смотрим результат

![Результат выполнения команд](task%205/task%205.png)<br>*Результат выполнения команд*<br>


<br>

## Part 6. Установка и настройка службы времени

**== Задание ==**

* Настроить службу автоматической синхронизации времени.  

- Вывести время, часового пояса, в котором вы сейчас находитесь.
- Вывод следующей команды должен содержать `NTPSynchronized=yes`: \
  `timedatectl show`
- Вставить скрины с корректным временем и выводом команды в отчёт.

<br>

**== Выполнение ==**

* Проверяем время которое установлено в данный момент командой `date`

![Установленое сейчас время](task%206/task%206.1.png)<br>*Установленое сейчас время*<br>

* Установка NTP командой `sudo apt install systemd-timesyncd`

* Активируем NTP командой `sudo timedatectl set-ntp on`

* Вывод команды `timedatectl show`

![Результат работы команды](task%206/task%206.2.png)<br>*Результат работы команды*<br>


<br>

## Part 7. Установка и использование текстовых редакторов 

**== Задание ==**

* Установить текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  

* 1) Используя каждый из трех выбранных редакторов, создайте файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.  

  - В отчёт вставьте скриншоты:
    - Из каждого редактора с содержимым файла перед закрытием.
  - В отчёте укажите, что сделали для выхода с сохранением изменений.

* 2) Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.

  - В отчёт вставьте скриншоты:
    - Из каждого редактора с содержимым файла после редактирования.
  - В отчёте укажите, что сделали для выхода без сохранения изменений.

* 3) Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.

  - В отчёт вставьте скриншоты:
    - Из каждого редактора с результатами поиска слова.
    - Из каждого редактора с командами, введёнными для замены слова на другое.

<br>

**== Выполнение ==**

* Используя команду `sudo apt install mc` устанавливаем текстовый редактор MCEDIT

### Exercise 1:

* **VIM** 

* Создаем файл с помощью команды `vim test_vim.txt`

* Нажимаем на "i" в самом редакторе, для редактирования

* Пишу свой ник: "carnaget"

Для выхода с сохранением нажимем `Esc` вводим команду `:wq` и нажимаем `Enter`

![VIM](task%207/task%207(VIM).png)<br>*VIM*<br>

<br>

* **NANO**

* Создаем файл с помощью команды `nano test_nano.txt`

* Пишу свой ник: "carnaget"

* Для выхода с сохранением нажимаем комбинацию `command+x` вводим `Y` и нажимаем`Enter`

![NANO](task%207/task%207(NANO).png)<br>*NANO*<br>

<br>

* **MCEDIT**

* Cоздаем файл с помощью команды `mcedit test_mcedit.txt`

* Пишу свой ник: "carnaget"

* Для выхода с сохранением нажимаем `Esc` и подтверждаем выход с сохранением

![MCEDIT](task%207/task%207(MCEDIT).png)<br>*MCEDIT*<br>

<br>

### Exercise 2:

* **VIM**

* Открываем файл с помощью команды `vim test_vim.txt`

* Нажимаем на "i" в самом редакторе, для редактирования

* Изменяем "carnaget" на "21 School 21"

* Для выхода без сохранения нажимаем `Esc` вводим команду `:q!` и нажимаем `Enter`

![VIM](task%207/task%207%20(VIM)2.png)<br>*VIM*<br>

* **NANO**

* Открываем файл с помощью команды `nano test_nano.txt`

* Изменяем "carnaget" на "21 School 21"

* Для выхода без сохранения нажимаем комбинацию `command+x` потом `N`

![NANO](task%207/task%207(NANO)2.png)<br>*NANO*<br>

* **MCEDIT**

* Открываем файл с помощью команды `mcedit test_mcedit.txt`.

* Изменяем "carnaget" на "21 School 21"

* Для выхода без сохранения нажимаем `Esc` и подтверждаем выход без сохранения

![MCEDIT](task%207/task%207%20(MKEDIT)2.png)<br>*MCEDIT*<br>

<br>

### Exercise 3:

* **VIM**

* Открываем файл с помощью команды `vim test_vim.txt`

* Для поиска в VIM вводим `/carnaget` и искомое слово выделяется в самом редакторе

![VIM](task%207/task%207(VIM)3.png)<br>*VIM*<br>

* Для замены слова в VIM вводим `:%s/carnaget/21 School 21` и слово "carnaget" заменяется на "21 School 21"

![VIM](task%207/task%207(VIM)3.1.png)<br>*VIM*<br>

<br>
* **NANO**

* Открываем файл с помощью команды `nano test_nano.txt`

* Для поиска в NANO вводим `command + W`

![NANO](task%207/task%207(NANO)3.png)<br>*NANO*<br>

* Для замены слова в NANO вводим `command + \`, пишем "carnaget", нажимаем `Enter`, пишем "21 School 21", нажимаем `Enter`, выбираем `Y`

![NANO](task%207/task%207%20(NANO)3.1.png)<br>*NANO*<br>

<br>

## Part 8. Установка и базовая настройка сервиса **SSHD**

**== Задание ==**

* 1) Установить службу SSHd.  

* 2) Добавить автостарт службы при загрузке системы.  

* 3) Перенастроить службу SSHd на порт 2022.  

* 4) Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.
- В отчёте объяснить значение команды и каждого ключа в ней.

* 5) Перезагрузить систему.
- В отчёте опишите, что сделали для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).
- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \
(если команды netstat нет, то ее нужно установить)
- Скрин с выводом команды вставить в отчёт.
- В отчёте объяснить значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.

<br>

**== Выполнение ==**

* Устанавливаем службу SSHd командой `sudo apt install openssh-server`

* Проверяем наличие командой `ssh -V`

![Служба SSHd](task%208/task%208.1.png)<br>*Служба SSHd*<br>

* Добавляем автостарт службы SSHd командой `sudo update-rc.d ssh defaults`

* Изменяем порт SSHd командой `sudo vim /etc/ssh/sshd_config`

* Добавляем строку `Port 2022`

![Изменёный конфиг](task%208/task%208.2.png)<br>*Изменёный кофиг*<br>

* Используем команду `/etc/init.d/ssh restart` для того что бы изменения вступили в силу

![Вывод команды](task%208/task%208.3.png)<br>*Вывод команды*<br>

Используем команду `ps -axfv | grep sshd` для проверки наличия процесса

![SSHd процесс](task%208/task%208.4.png)<br>*SSHd процесс*<br>

* Команда `ps` показывает текущие процессы на сервере. 

* Команда `grep` позволяет выдилить нужную нам информацию по процессам

* флаг -a оставляет все процессы, кроме лидеров сеансов и процессов, не связанных с терминалом

* флаг -x заставляет `ps` отображать список всех процессов, которыми вы владеете

* флаг -f выводит полноформатный список

* флаг -v выводит информацию о версии

<br>
* Устанавливаем *net-tools* `sudo apt install net-tools`

* Выполняем команду `netstat -tan`

![Выполнение команды netstat -tan](task%208/task%208.5.png)<br>*Выполнение команды netstat -tan*<br>

* Опция -a показывает состояние всех сокетов

* -n показывает ip адрес, а не сетевое имя

* -t показывает только tcp соединения

* стобец Proto - протокол, используемый сокетом

* стобец Recv-Q - количество байтов, не скопированных пользовательской программой, подключенной к этому сокету

* стобец Local Adbress - локальный адрес (имя локального хоста) и номер порта сокета

* стобец Foreign Adbress - удаленный адрес (имя удаленного хоста) и номер порта сокета

* стобец State - состояние сокета

* Перезагружаем систему командой `sudo reboot`


<br>

## Part 9. Установка и использование утилит **top**, **htop**

**== Задание ==**

* Установить и запустить утилиты top и htop.  

- По выводу команды top определить и написать в отчёте:
  - uptime
  - количество авторизованных пользователей
  - общую загрузку системы
  - общее количество процессов
  - загрузку cpu
  - загрузку памяти
  - pid процесса занимающего больше всего памяти
  - pid процесса, занимающего больше всего процессорного времени

- В отчёт вставить скрин с выводом команды htop:
  - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
  - отфильтрованному для процесса sshd
  - с процессом syslog, найденным, используя поиск 
  - с добавленным выводом hostname, clock и uptime

<br>

**== Выполнение ==**

* Командой `top` запускаем соответствующую утилиту

![Запуск top](task%209/task%209.png)<br>*Запуск top*<br>

* uptime
![uptime](task%209/task%209.1.png)

* количество авторизированных пользователей
![kap](task%209/task%209.3.png)

* общая загрузка системы
![ozs](task%209/task%209.4.png)

* общее количество процессов
![okp](task%209/task%209.5.png)

* загрузка cpu
![cpu](task%209/task%209.6.png)

* загрузка памяти
![mem](task%209/task%209.7.png)

* pid процесса, занимающего больше всего памяти
![pm](task%209/task%209.8.png)

<br>

*  командой `htop` запускаем утилиту

![Запуск htop](task%209/task%209.9.png)<br>*Запуск htop*<br>

* Для выбора того как проводить сортировку мы нажимаем `F6`

* PID
![PID](task%209/task%209.10.png)

* PERCENT_CPU
![PERCENT_CPU](task%209/task%209.11.png)

* PERCENT_MEM
![PERCENT_MEM](task%209/task%209.12.png)

* TIME
![TIME](task%209/task%209.13.png)

* Для работы с фильтром нажимаем `F4`

* После мы вводим `SShd` и нажимаем `Enter`

* фильтр по SSHd
![SSHd](task%209/task%209.14.png)

* Для работы с поиском нажимаем `F3`

* После мы вводим `syslog` и нажимаем `Enter`

* Результат поиска
![Поиск syslog](task%209/task%209.15.png)


<br>

## Part 10. Использование утилиты **fdisk**

**== Задание ==**

* Запустить команду fdisk -l.
  - В отчёте написать название жесткого диска, его размер и количество секторов, а также размер swap.

<br>

**== Выполнение ==**

* Запуск утилиты командой `sudo fdisk -l`

![Вывод команды](task%2010/task%2010.png)<br>*Вывод команды*<br>

* Название жесткого диска VBOX HARDDISK
![Название жесткого диска](task%2010/task%2010.1.png)

* Размер
![Размер](task%2010/task%2010.2.png)

* Количество секторов
![Количество секторов](task%2010/task%2010.3.png)

* Размер swap (пришлось использовать команду `free -h`)
![Размер swap](task%2010/task%2010.4.png)


<br>

## Part 11. Использование утилиты **df** 

**== Задание ==**

* Запустить команду df.  
- В отчёте написать для корневого раздела (/):
  - размер раздела
  - размер занятого пространства
  - размер свободного пространства
  - процент использования
- Определить и написать в отчёт единицу измерения в выводе.  

* Запустить команду df -Th.
- В отчёте написать для корневого раздела (/):
    - размер раздела
    - размер занятого пространства
    - размер свободного пространства
    - процент использования
- Определить и написать в отчёт тип файловой системы для раздела.

<br>

**== Выполнение ==**

* используем команду `df /`
![Вывод команды](task%2011/task%2011.png)<br>*Вывод команды*<br>
    
* Размер раздела
![Размер раздела](task%2011/task%2011.1.png)

* Размер занятого пространства
![Размер занятого пространства](task%2011/task%2011.2.png)

* Размер свободного пространства
![Размер свободного пространств](task%2011/task%2011.3.png)

* Процент использования
![Процент использования](task%2011/task%2011.4.png)

<br>

* используем команду `df -Th /`
![Вывод команды](task%2011/task%2011.5.png)<br>*Вывод команды*<br>

* Размер раздела
![Размер раздела](task%2011/task%2011.6.png)

* Размер занятого пространства
![Размер занятого пространства](task%2011/task%2011.7.png)

* Размер свободного пространства
![Размер свободного пространства](task%2011/task%2011.8.png)

* Процент использования
![Процент использования](task%2011/task%2011.9.png)

* Тип файловой системы для раздела
![Тип файловой системы для раздела](task%2011/task%2011.10.png)

<br>

## Part 12. Использование утилиты **du**

**== Задание ==**

* Запустить команду du.

* Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)

* Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

- В отчёт вставить скрины с выводом всех использованных команд.

<br>

**== Выполнение ==**

* Запуcк команды `du`
![Вывод команды du](task%2012/task%2012.png)<br>*Вывод команды*<br>

* С помощью команды `sudo du -s -h /home && sudo du -s -h /var && sudo du -s -h /var/log` выводим размер папок
![Размер папок](task%2012/task%2012.1.png)<br>*Размер папок*<br>
    
* Вывести размер `/var/log` с помощью команды `sudo du -a -h /var/log`
![Размер](task%2012/task%2012.2.png)<br>*Размер*<br>

<br>

## Part 13. Установка и использование утилиты **ncdu**

**== Задание ==**

* Установить утилиту ncdu.

* Вывести размер папок /home, /var, /var/log.

- Размеры должны примерно совпадать с полученными в [Part 12](#part-12-использование-утилиты-du).

- В отчёт вставить скрины с выводом использованных команд.

<br>

**== Выполнение ==**

* Командой `sudo apt install ncdu` устанавливаем ncdu

* Вывести размер папок с помощью команды `ncdu`

![/home](task%2013/task%2013.1.png)<br>*/home*<br>

![/var](task%2013/task%2013.2.png)<br>*/var*<br>

![/var/log](task%2013/task%2013.3.png)<br>*/var/log*<br>

<br>

## Part 14. Работа с системными журналами

**== Задание ==**

* Открыть для просмотра:
* 1. /var/log/dmesg
* 2. /var/log/syslog
* 3. /var/log/auth.log  

- Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему.
- Перезапустить службу SSHd.
- Вставить в отчёт скрин с сообщением о рестарте службы (искать в логах).

<br>

**== Выполнение ==**

* Просмотр /var/log/dmesg
![Просмотр /var/log/dmesg](task%2014/task%2014.png)

* Просмотр /var/log/syslog
![Просмотр /var/log/syslog](task%2014/task%2014.1.png)

* Просмотр /var/log/auth.log
![Просмотр /var/log/auth.log](task%2014/task%2014.2.png)
    

* Время авторизации Aug 10 19:17
* Имя пользователя carnaget
* Метод входа в систему tty6

* Командой `sudo /etc/init.d/ssh restart` перезапускаем службу SSHd

![Результат работы команды](task%2014/task%2014.3.png)<br>*Результат работы команды*<br>

* Командой `sudo cat /var/log/syslog` выводим сообщение о рестарте служб
![Результат работы команды](task%2014/task%2014.4.png)<br>*Результат работы команды*<br>

<br>

## Part 15. Использование планировщика заданий **CRON**

**== Задание ==**

* Используя планировщик заданий, запустите команду uptime через каждые 2 минуты.
- Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении.
- Вывести на экран список текущих заданий для CRON.
- Вставить в отчёт скрины со строчками о выполнении и списком текущих задач.

* Удалите все задания из планировщика заданий.
- В отчёт вставьте скрин со списком текущих заданий для CRON.

<br>

**== Выполнение ==**

* Используем команду `sudo apt install cron` для установки **CRON**

* Планируем задачу командой `crontab -e`

* В vim приписываем `"*/2 * * * * uptime"`

![uptime](task%2015/task%2015.png)<br>*uptime*<br>

* Командой `crontab -l` выводим список установленых задач

![Список текущих заданий](task%2015/task%2015.1.png)<br>*Список текущих заданий*<br>

* Командой `sudo grep CRON /var/log/syslog` выводим системных задач

![Системный журнал](task%2015/task%2015.2.png)<br>*Системный журнал*<br>

* Командой `crontab -r` удаляем все запланированые задачи

* Проверяем список задач ещё раз

![Системный журнал](task%2015/task%2015.3.png)<br>*Системный журнал*<br>
